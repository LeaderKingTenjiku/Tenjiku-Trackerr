<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Risk Detector</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f4faff;
      color: #1a1a1a;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 650px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }

    h1 {
      color: #0070f3;
      text-align: center;
      margin-bottom: 25px;
    }

    input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      background-color: #0070f3;
      color: white;
      padding: 12px;
      border: none;
      font-size: 16px;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
    }

    button:hover {
      background-color: #0051c3;
    }

    .result {
      margin-top: 25px;
      background: #eef5ff;
      padding: 20px;
      border-radius: 8px;
    }

    canvas {
      margin-top: 20px;
      background: white;
      border-radius: 12px;
      padding: 10px;
    }

    .status {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üß™ Rug Pull Detector</h1>

    <input type="text" id="tokenAddress" placeholder="Enter ERC-20 Token Address">
    <button onclick="checkRug()">Check Risk</button>

    <div class="result" id="rugResult" style="display:none;">
      <div class="status" id="riskStatus">Checking...</div>
      <div id="riskReasons"></div>

      <canvas id="riskPieChart" height="200"></canvas>
      <canvas id="riskLineChart" height="250"></canvas>
    </div>
  </div>

  <script>
    let pieChart, lineChart;

    async function checkRug() {
      const address = document.getElementById("tokenAddress").value.trim();
      const resultBox = document.getElementById("rugResult");
      const status = document.getElementById("riskStatus");
      const reasons = document.getElementById("riskReasons");

      if (!address) {
        status.innerText = "‚ö†Ô∏è Please enter a token address.";
        resultBox.style.display = "block";
        return;
      }

      status.innerText = "‚è≥ Checking risk...";
      reasons.innerHTML = "";
      resultBox.style.display = "block";

      try {
        const res = await fetch(`https://api.ethplorer.io/getTopTokenHolders/${address}?apiKey=freekey`);
        const data = await res.json();

        if (!data.holders || data.holders.length === 0) {
          status.innerText = "‚ùå Token info not found. Try another address.";
          return;
        }

        const topHolder = data.holders[0].share || 0;
        let risk = 0;
        let reasonText = "";

        if (topHolder >= 50) {
          risk = 90;
          reasonText = `üö® Top holder owns ${topHolder.toFixed(2)}% - Very High Risk`;
        } else if (topHolder >= 30) {
          risk = 70;
          reasonText = `‚ö†Ô∏è Top holder owns ${topHolder.toFixed(2)}% - Medium Risk`;
        } else {
          risk = 30;
          reasonText = `‚úÖ Top holder owns ${topHolder.toFixed(2)}% - Low Risk`;
        }

        let label = "";
        if (risk >= 80) label = "üî¥ HIGH RISK";
        else if (risk >= 60) label = "üü† MEDIUM RISK";
        else label = "üü¢ LOW RISK";

        status.innerText = `Rug Pull Risk Score: ${risk}% ‚Äî ${label}`;
        reasons.innerHTML = `<p>${reasonText}</p>`;

        // Pie Chart
        const pieCtx = document.getElementById("riskPieChart").getContext("2d");
        if (pieChart) pieChart.destroy();
        pieChart = new Chart(pieCtx, {
          type: "doughnut",
          data: {
            labels: ["Risk", "Safety"],
            datasets: [{
              data: [risk, 100 - risk],
              backgroundColor: ["#ff4d4f", "#36cfc9"],
              borderWidth: 1
            }]
          },
          options: {
            plugins: { legend: { position: "bottom" } }
          }
        });

        // Line Graph of Risk Mapping (Top Holder % vs Risk Score)
        const lineCtx = document.getElementById("riskLineChart").getContext("2d");
        if (lineChart) lineChart.destroy();
        lineChart = new Chart(lineCtx, {
          type: "line",
          data: {
            labels: [0, 10, 20, 30, 40, 50, 60, 70],
            datasets: [{
              label: "Risk Score Based on Holder %",
              data: [10, 20, 35, 60, 75, 90, 95, 100],
              borderColor: "#0070f3",
              fill: false,
              tension: 0.4
            }, {
              label: `Your Token: ${topHolder.toFixed(1)}% Holder`,
              data: new Array(8).fill(null).map((_, i) => i * 10 === Math.floor(topHolder) ? risk : null),
              pointBackgroundColor: "#ff4d4f",
              pointRadius: 6,
              showLine: false
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { position: "bottom" } },
            scales: {
              x: { title: { display: true, text: "Top Holder %" } },
              y: { title: { display: true, text: "Risk Score" }, min: 0, max: 100 }
            }
          }
        });

      } catch (err) {
        status.innerText = "‚ùå Error checking. Try again later.";
        console.error(err);
      }
    }
  </script>

</body>
</html>
